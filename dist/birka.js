(function(){'use strict';var d;d={compiler:{},project:{},system:{},ui:{}};d.ui.View=function(a){this.element=null;this.name=a||"";this.toolHeader=null};d.ui.View.prototype.initHeader=function(){this.element=document.getElementById("tool-wrapper");this.toolHeader=e.appendNewClassElem(this.element,"div","tool-header");var a=e.appendNewElem(this.toolHeader,"h2");e.setText(a,this.name);this.m_initTitle()};d.ui.View.prototype.m_initTitle=function(){document.title=window.sessionStorage.name};/*
 Copyright (c) 2019.
 @license Creative Commons (BY-NC-SA)
*/
var e={createElem:function(a){return document.createElement(a)},createClassElem:function(a,b){a=document.createElement(a);void 0!==b&&a.setAttribute("class",b);return a},createIdElem:function(a,b){a=document.createElement(a);void 0!==b&&a.setAttribute("id",b);return a},appendNewElem:function(a,b){b=e.createElem(b);a.appendChild(b);return b},appendNewClassElem:function(a,b,c){b=e.createClassElem(b,c);a.appendChild(b);return b},appendNewIdElem:function(a,b,c){b=e.createIdElem(b,c);a.appendChild(b);
return b},prependNewElem:function(a,b){b=e.createElem(b);a.insertBefore(b,a.firstChild);return b},prependNewClassElem:function(a,b,c){b=e.createClassElem(b,c);a.insertBefore(b,a.firstChild);return b},prependNewIdElem:function(a,b,c){b=e.createIdElem(b,c);a.insertBefore(b,a.firstChild);return b},img:function(a,b){var c=e.createElem("img");c.setAttribute("src",a);c.setAttribute("alt",b);return c},link:function(a,b){var c=e.createElem("a");c.setAttribute("href",a);a=document.createTextNode(b);c.appendChild(a);
return c},p:function(a){var b=e.createElem("p");a=document.createTextNode(a);b.appendChild(a);return b},setText:function(a,b){b=document.createTextNode(b);a.appendChild(b)}};d.Projectdirectory=function(a){this.m_project=a.name||"";this.m_output=a.location+"/"+a.name||"";this.m_title=a.title||"";this.m_id=a.id||"";this.m_resquestQueue=[];this.m_request={};this.m_folders="/bin-debug/ /lib/ /src/data/ /src/scene/ /src/scope/ /src/system/".split(" ");this.m_files=[{name:"Main.js",template:"/templates/Main.txt",directory:"/src/system/"},{name:"rune.js",url:"https://raw.githubusercontent.com/VectorPanic/rune/master/dist/rune.js",template:"",directory:"/lib/"},{name:"SceneMain.js",
template:"/templates/SceneMain.txt",directory:"/src/scene/"},{name:"Alias.js",template:"/templates/Alias.txt",directory:"/src/scope/"},{name:"Manifest.js",template:"/templates/Manifest.txt",directory:"/src/scope/"},{name:"Index.html",template:"/templates/Index.txt",directory:"/bin-debug/"}]};d.Projectdirectory.fs=require("fs");d.Projectdirectory.mkdirp=require("mkdirp");d.Projectdirectory.prototype.create=function(){this.m_initFolders()};
d.Projectdirectory.prototype.m_initFolders=function(){for(var a=0;a<this.m_folders.length;a++)this.m_checkDirectory(this.m_folders[a]);this.m_initFiles()};d.Projectdirectory.prototype.m_initFiles=function(){this.m_resquestQueue=this.m_files;this.m_processRequestQueue()};d.Projectdirectory.prototype.m_processRequestQueue=function(){0<this.m_resquestQueue.length?(this.m_request=this.m_resquestQueue.shift(),this.m_processRequest()):this.m_onComplete()};
d.Projectdirectory.prototype.m_processRequest=function(){"rune.js"==this.m_request.name?this.m_getURLdata():this.m_createFileData()};d.Projectdirectory.prototype.m_getURLdata=function(){var a=this,b=new XMLHttpRequest;b.open("GET",this.m_request.url,!0);b.onreadystatechange=function(){4===b.readyState&&(200===b.status?a.m_saveDataToFile(this.responseText):console.log("Error..."))};b.send()};d.Projectdirectory.prototype.m_checkDirectory=function(a){d.Projectdirectory.mkdirp.sync(this.m_output+a)};
d.Projectdirectory.prototype.m_createFileData=function(){var a=this.m_readTemplate(this.m_request.template).replace(/%APP%/g,this.m_project);"Main.js"==this.m_request.name&&(a=a.replace(/%TITLE%/g,this.m_title),a=a.replace(/%ID%/g,this.m_id));this.m_saveDataToFile(a)};d.Projectdirectory.prototype.m_saveDataToFile=function(a){var b=this;d.Projectdirectory.fs.writeFile(this.m_output+this.m_request.directory+this.m_request.name,a,function(a){if(a)throw a;b.m_processRequestQueue()})};
d.Projectdirectory.prototype.m_readTemplate=function(a){return d.Projectdirectory.fs.readFileSync(__dirname+a).toString()};d.Projectdirectory.prototype.m_onComplete=function(){this.m_request=this.m_resquestQueue=null;console.log("Directory complete!")};d.Projectdirectory.prototype.m_onError=function(){};d.Resourcefile=function(a,b){this.m_project=a||"";this.m_output=b||"";this.m_resquestQueue=[];this.m_request={};this.m_tempArr=[]};d.Resourcefile.fs=require("fs");d.Resourcefile.prototype.compile=function(a){0<a.length?(this.m_resquestQueue=a,this.m_processRequestQueue()):this.m_writeFile()};d.Resourcefile.prototype.m_processRequestQueue=function(){0<this.m_resquestQueue.length?(this.m_request=this.m_resquestQueue.shift(),this.m_processRequest()):this.m_writeFile()};
d.Resourcefile.prototype.m_processRequest=function(){this.m_generateBase64(this.m_request.blob,this.m_request.name)};d.Resourcefile.prototype.m_generateBase64=function(a,b){var c=this,g=new FileReader;g.onload=function(){c.m_generateResponse(b,g.result);c.m_resquest=null;c.m_processRequestQueue()};g.readAsDataURL(a)};d.Resourcefile.prototype.m_generateResponse=function(a,b){this.m_tempArr.push('this.create("'+a+'", "'+b+'");')};
d.Resourcefile.prototype.m_writeFile=function(){var a=this.m_readTemplate().replace(/%APP%/g,this.m_project),b=this.m_tempArr.join("\n\t");a=a.replace("%RESOURCES%",b);this.m_saveDataToFile(a)};d.Resourcefile.prototype.m_saveDataToFile=function(a){var b=this;d.Resourcefile.fs.writeFile(this.m_output+"/src/data/Resources.js",a,function(a){if(a)throw a;b.m_onComplete()})};d.Resourcefile.prototype.m_readTemplate=function(){return d.Resourcefile.fs.readFileSync(__dirname+"/templates/Resources.txt").toString()};
d.Resourcefile.prototype.m_onComplete=function(){this.m_tempArr=[];this.m_resquestQueue=[];this.m_request={};this.m_output=this.m_project="";console.log("Resource file has been saved!");alert("Resource file has been saved!")};d.project.Toolbar=function(){this.m_tabs=[];this.m_init()};Object.defineProperty(d.project.Toolbar.prototype,"tabs",{get:function(){return this.m_tabs}});
d.project.Toolbar.prototype.m_init=function(){var a=document.getElementById("app-content");a=e.appendNewIdElem(a,"div","nav-wrapper");a=e.appendNewElem(a,"nav");a=e.appendNewElem(a,"ul");var b=[];this.m_tabs=[];for(var c=0;2>c;c++)b.push(e.appendNewElem(a,"li")),this.m_tabs.push(e.appendNewElem(b[c],"a")),this.m_tabs[c].setAttribute("href","#");this.m_tabs[0].innerHTML="Overview";this.m_tabs[0].id="overview";this.m_tabs[0].setAttribute("class","active");this.m_tabs[1].innerHTML="Compiler";this.m_tabs[1].id=
"compiler"};d.project.Modal=function(a,b){this.element=e.appendNewClassElem(document.body,"div","dialog");this.modal=a;this.options=b;this.m_footer=this.content=this.browseBtn=null;this.buttons=[];this.init()};
d.project.Modal.prototype.init=function(){var a=this,b=e.appendNewClassElem(this.element,"div","dialog-container"),c=e.appendNewClassElem(b,"div","dialog-header");c=e.appendNewElem(c,"h1");0<this.options.title.length&&(c.innerHTML=this.options.title);b=e.appendNewElem(b,"form");this.content=e.appendNewClassElem(b,"div","dialog-content");this.m_footer=e.appendNewClassElem(b,"div","dialog-footer");this.m_initFooterButtons();"error"===this.options.type?this.m_initMessage(this.options.type):"warning"===
this.options.type?this.m_initMessage(this.options.type):"custom"===this.options.type&&this.m_initCustom();this.element.addEventListener("click",function(b){"dialog"===b.target.className&&a.m_close()})};d.project.Modal.prototype.m_initMessage=function(a){0<this.options.message.length&&(a=e.appendNewClassElem(this.content,"p","dialog-"+a),a.innerHTML=this.options.message)};d.project.Modal.prototype.m_initCustom=function(){};
d.project.Modal.prototype.m_initFooterButtons=function(){var a=this;this.buttons=[];for(var b=0;1>b;b++)this.buttons.push(e.appendNewClassElem(this.m_footer,"input","button")),this.buttons[b].setAttribute("type","button");this.buttons[0].value="OK";this.buttons[0].addEventListener("click",function(){a.m_close(this)})};d.project.Modal.prototype.m_close=function(){this.element.parentNode.removeChild(this.element);this.modal=null};d.project.CreateModal=function(a,b){this.element=e.appendNewClassElem(document.body,"div","dialog");this.modal=a;this.options=b;this.locationpath=this.browseBtn=null;this.spans=[];this.buttons=[];this.paths=[];this.init()};d.project.CreateModal.dialog=require("electron").remote.dialog;d.project.CreateModal.fs=require("fs");d.project.CreateModal.path=require("path");d.project.CreateModal.prototype=Object.create(d.project.Modal.prototype);d.project.CreateModal.prototype.constructor=d.project.CreateModal;
d.project.CreateModal.prototype.m_initCustom=function(){var a=this,b=e.appendNewElem(this.content,"div"),c=e.appendNewElem(b,"span");e.setText(c,"Project name");this.inputs=[];c=e.appendNewClassElem(b,"input","game-name");c.setAttribute("type","text");c.setAttribute("placeholder","Write your project name...");c.setAttribute("required","");c.setAttribute("minlength","1");this.inputs.push(c);this.spans=[];for(c=0;4>c;c++)this.spans.push(e.createClassElem("span","spanerror"));b.appendChild(this.spans[0]);
b=[];var g=[];for(c=0;2>c;c++)b.push(e.appendNewElem(this.content,"fieldset")),g.push(e.appendNewElem(b[c],"legend"));g[0].innerHTML="Project location";g[1].innerHTML="Configuration settings";g=e.appendNewClassElem(b[0],"div","input-field");this.locationpath=e.appendNewClassElem(g,"div","filepath");this.browseBtn=e.appendNewClassElem(g,"input","project-browse");this.browseBtn.setAttribute("type","button");b[0].appendChild(this.spans[1]);var f=[];for(c=0;2>c;c++);f[0]=e.appendNewElem(b[1],"label");
this.inputs[1]=e.appendNewElem(b[1],"input");b[1].appendChild(this.spans[2]);f[1]=e.appendNewElem(b[1],"label");this.inputs[2]=e.appendNewElem(b[1],"input");b[1].appendChild(this.spans[3]);f[0].innerHTML="Id";this.inputs[1].setAttribute("type","number");this.inputs[1].setAttribute("placeholder","E.g. 0");this.inputs[1].setAttribute("required","");f[1].innerHTML="Title";this.inputs[2].setAttribute("type","text");this.inputs[2].setAttribute("placeholder","Title");this.inputs[2].setAttribute("required",
"");g.addEventListener("click",function(){a.m_chooseLocation(this)});this.inputs[0].addEventListener("input",function(){a.inputs[0].validity.valid&&(a.spans[0].innerHTML="",a.spans[0].className="spanerror")},!1);this.inputs[1].addEventListener("input",function(b){a.inputs[1].validity.valid&&(a.spans[2].innerHTML="",a.spans[2].className="spanerror",b.preventDefault())},!1);this.inputs[2].addEventListener("input",function(){a.inputs[2].validity.valid&&(a.spans[3].innerHTML="",a.spans[3].className="spanerror")},
!1)};
d.project.CreateModal.prototype.save=function(a,b){var c=this;c.inputs[0].validity.valid||(c.spans[0].innerHTML="Fill in a project name.",c.spans[0].className="spanerror active");c.inputs[1].validity.valid||(c.spans[2].innerHTML="Fill in an id for your project.",c.spans[2].className="spanerror active");c.inputs[2].validity.valid||(c.spans[3].innerHTML="Fill in a title for your project.",c.spans[3].className="spanerror active");""===c.locationpath.innerHTML&&(c.spans[1].innerHTML="Please choose a location for your project.",c.spans[1].className=
"spanerror active");if(c.inputs[0].validity.valid&&c.inputs[1].validity.valid&&c.inputs[2].validity.valid&&""!==c.locationpath.innerHTML)if(!1===c.m_walkDir(c.locationpath.innerHTML,c.locationpath.innerHTML+"/"+c.inputs[0].value)){var g=c.locationpath.innerHTML.replace(/^.*[\\\/]/,"");d.project.CreateModal.dialog.showMessageBox({title:"Warning",type:"warning",message:"A file or folder with this name already exists in the folder "+g+". Replacing it will overwrite its current contents.",icon:"./src/img/error.png",
buttons:["Overwrite","Cancel"],cancelId:1},function(g){if(1!==g&&0===g){g={name:c.inputs[0].value,location:c.locationpath.innerHTML,id:c.inputs[1].value,title:c.inputs[2].value};window.sessionStorage.setItem("loaded","true");window.sessionStorage.setItem("name",c.inputs[0].value);window.sessionStorage.setItem("projectLocation",c.locationpath.innerHTML+"/"+c.inputs[0].value);window.sessionStorage.setItem("output",c.locationpath.innerHTML+"/"+c.inputs[0].value+"/src/data");if(null!==window.localStorage.getItem("recentProjects")){var f=
JSON.parse(window.localStorage.getItem("recentProjects"));console.log(f);f.projects.unshift(c.locationpath.innerHTML+"/"+c.inputs[0].value);5<f.projects.length&&f.projects.splice(5);window.localStorage.setItem("recentProjects",JSON.stringify(f))}else f={projects:[c.locationpath.innerHTML+"/"+c.inputs[0].value]},window.localStorage.setItem("recentProjects",JSON.stringify(f)),console.log(window.localStorage.getItem("recentProjects"));(new d.Projectdirectory(g)).create();c.m_close();a(b)}})}else{g={name:c.inputs[0].value,
location:c.locationpath.innerHTML,id:c.inputs[1].value,title:c.inputs[2].value};window.sessionStorage.setItem("loaded","true");window.sessionStorage.setItem("name",c.inputs[0].value);window.sessionStorage.setItem("projectLocation",c.locationpath.innerHTML+"/"+c.inputs[0].value);window.sessionStorage.setItem("output",c.locationpath.innerHTML+"/"+c.inputs[0].value+"/src/data");if(null!==window.localStorage.getItem("recentProjects")){var f=JSON.parse(window.localStorage.getItem("recentProjects"));f.projects.unshift(c.locationpath.innerHTML+
"/"+c.inputs[0].value);5<f.projects.length&&f.projects.splice(5);window.localStorage.setItem("recentProjects",JSON.stringify(f))}else f={projects:[c.locationpath.innerHTML+"/"+c.inputs[0].value]},window.localStorage.setItem("recentProjects",JSON.stringify(f)),console.log(window.localStorage.getItem("recentProjects"));(new d.Projectdirectory(g)).create();c.m_close();a(b)}};
d.project.CreateModal.prototype.m_walkDir=function(a,b){var c=[],g=!0;d.project.CreateModal.fs.readdirSync(a).forEach(function(b){b=d.project.ProjectManager.path.join(a,b);b.match(/(^|\/)\.[^\/\.]/g)||c.push(b)});for(var f=0;f<c.length;f++)c[f]===b&&(g=!1);return g};d.project.CreateModal.prototype.m_electronDialog=function(a,b){d.project.CreateModal.dialog.showMessageBox({title:"Warning",type:"warning",message:a,icon:"./src/img/error.png",buttons:["Replace","Cancel"],cancelId:1,detail:b},function(a){console.log(a)})};
d.project.CreateModal.prototype.m_chooseLocation=function(){var a=this;d.project.CreateModal.dialog.showOpenDialog({title:"Select a folder",properties:["openDirectory"]},function(b){void 0!==b&&0!==b.length&&(0<a.spans.length&&(a.spans[1].innerHTML="",a.spans[1].className="spanerror"),a.locationpath.innerHTML=b[0])})};
d.project.CreateModal.prototype.m_initFooterButtons=function(){for(var a=this,b=0;2>b;b++)this.buttons.push(e.appendNewClassElem(this.m_footer,"input","button")),this.buttons[b].setAttribute("type","button");this.buttons[0].value="Cancel";this.buttons[1].value="Create";this.buttons[0].addEventListener("click",function(){a.m_close(this)})};d.project.ElementManager=function(){this.projectElem=this.toolWrapper=null;this.buttons={};this.rightElem=null;this.paths=[];this.links=[]};d.project.ElementManager.prototype.init=function(){this.m_initLeft();this.m_initRight()};d.project.ElementManager.prototype.removeElems=function(){for(;this.toolWrapper.hasChildNodes();)this.toolWrapper.removeChild(this.toolWrapper.firstChild)};
d.project.ElementManager.prototype.m_initLeft=function(){this.toolWrapper=document.getElementById("app-content");this.projectElem=e.appendNewElem(this.toolWrapper,"div");this.projectElem.setAttribute("id","project");var a=e.appendNewClassElem(this.projectElem,"div","project-left"),b=e.appendNewElem(a,"h2");e.setText(b,"Let's get started!");b=e.appendNewElem(a,"p");e.setText(b,"Start by selecting an existing project or create a new project.");a=e.appendNewElem(a,"div");b=[];for(var c=0;2>c;c++);b[0]=
e.appendNewElem(a,"input");b[0].setAttribute("type","button");c=e.appendNewElem(a,"h3");e.setText(c,"OR");b[1]=e.appendNewElem(a,"input");b[1].setAttribute("type","button");b[0].setAttribute("value","Choose project...");b[1].setAttribute("value","Create new project");this.buttons={chooseBtn:b[0],createBtn:b[1]}};
d.project.ElementManager.prototype.m_initRight=function(){this.rightElem=e.appendNewClassElem(this.projectElem,"div","project-right");var a=e.appendNewClassElem(this.rightElem,"div","recent-projects"),b=e.appendNewElem(a,"h3");e.setText(b,"Open recent project");b=[];var c=[];if(null!==window.localStorage.getItem("recentProjects")){var g=JSON.parse(window.localStorage.getItem("recentProjects"));if(0<g.projects.length)for(var f=0;f<g.projects.length;f++){this.links.push(e.appendNewElem(a,"a"));this.links[f].setAttribute("href",
"#");b.push(e.appendNewElem(this.links[f],"div"));c.push(e.appendNewElem(b[f],"h4"));var h=g.projects[f].replace(/^.*[\\\/]/,"");e.setText(c[f],h);this.paths.push(e.appendNewElem(b[f],"p"));e.setText(this.paths[f],g.projects[f])}else a=e.appendNewElem(a,"p"),e.setText(a,"...")}};d.project.ElementManager.prototype.m_removeElems=function(){for(;this.rightElem.hasChildNodes();)this.rightElem.removeChild(this.rightElem.firstChild)};d.project.Project=function(){this.m_toolWrapper=this.m_toolbar=this.m_appContent=null;this.m_tabs=[];this.m_activeTool=null};d.project.Project.prototype.init=function(){this.m_appContent=document.getElementById("app-content");this.m_clearWindow();this.m_initUI()};
d.project.Project.prototype.m_initUI=function(){var a=this;this.m_toolbar=new d.project.Toolbar;this.m_tabs=this.m_toolbar.tabs;for(var b=0;b<this.m_tabs.length;b++)this.m_tabs[b].addEventListener("click",function(b){a.changeTool(b,this)});this.m_toolWrapper=e.appendNewIdElem(this.m_appContent,"div","tool-wrapper");this.m_initProjectDetails();this.m_initTitle()};
d.project.Project.prototype.m_initProjectDetails=function(){e.appendNewElem(this.m_toolWrapper,"h2");var a=e.appendNewClassElem(this.m_toolWrapper,"div","tool-header");a=e.appendNewElem(a,"h2");e.setText(a,"Project name: "+window.sessionStorage.name)};d.project.Project.prototype.m_initTitle=function(){document.title=window.sessionStorage.name};
d.project.Project.prototype.changeTool=function(a,b){if(!b.classList.contains("active")){for(var c=0;c<this.m_tabs.length;c++)this.m_tabs[c].classList.remove("active");b.classList.toggle("active");this.startTool(a.target.id)}};d.project.Project.prototype.startTool=function(a){switch(a){case "overview":this.removeTool();this.m_activeTool=new d.project.Project;this.m_activeTool.init();break;case "compiler":this.removeTool(),this.m_activeTool=new d.compiler.Compiler,this.m_activeTool.init()}};
d.project.Project.prototype.m_clearWindow=function(){for(;this.m_appContent.hasChildNodes();)this.m_appContent.removeChild(this.m_appContent.firstChild)};d.project.Project.prototype.removeTool=function(){for(;this.m_toolWrapper.hasChildNodes();)this.m_toolWrapper.removeChild(this.m_toolWrapper.firstChild);this.m_activeTool=null};d.project.ProjectManager=function(a){this.callback=a;this.elemManager=null;this.paths=[];this.modal=null};d.project.ProjectManager.dialog=require("electron").remote.dialog;d.project.ProjectManager.fs=require("fs");d.project.ProjectManager.path=require("path");d.project.ProjectManager.prototype.init=function(){this.m_initUI()};d.project.ProjectManager.prototype.m_initUI=function(){this.elemManager=new d.project.ElementManager(this.toolWrapper);this.elemManager.init();this.m_addListeners()};
d.project.ProjectManager.prototype.m_addListeners=function(){var a=this;this.elemManager.buttons.createBtn.addEventListener("click",function(){a.m_createProject(this)});this.elemManager.buttons.chooseBtn.addEventListener("click",function(){a.m_openProject(this)});for(var b=0;b<this.elemManager.links.length;b++)this.elemManager.links[b].addEventListener("click",function(){a.m_loadProject(this.querySelector("p").innerHTML)});JSON.parse(window.localStorage.getItem("recentProjects"))};
d.project.ProjectManager.prototype.m_createProject=function(){var a=this;a.modal=new d.project.CreateModal(a.modal,{type:"custom",title:"Create project"});a.modal.buttons[1].addEventListener("click",function(){a.modal.save(a.m_saveProject,a)})};d.project.ProjectManager.prototype.m_saveProject=function(a){var b=new d.project.Project;a.callback(b)};
d.project.ProjectManager.prototype.m_openProject=function(){var a=this;d.project.ProjectManager.dialog.showOpenDialog({title:"Select a folder",properties:["openDirectory"]},function(b){void 0!==b&&0!==b.length&&a.m_loadProject(b[0])})};
d.project.ProjectManager.prototype.m_loadProject=function(a){if(!1!==this.m_checkIfFolder(a))if(this.m_checkProjectValidity(a,this.m_walkDir(a))){var b=a.replace(/^.*[\\\/]/,"");window.sessionStorage.setItem("name",b);window.sessionStorage.setItem("projectLocation",a);window.sessionStorage.setItem("output",a+"/src/data");window.sessionStorage.setItem("loaded","true");if(null!==window.localStorage.getItem("recentProjects")){b=JSON.parse(window.localStorage.getItem("recentProjects"));for(var c=0;c<
b.projects.length;c++)b.projects[c]===a&&b.projects.splice(c,1);b.projects.unshift(a);5<b.projects.length&&b.projects.splice(5);window.localStorage.setItem("recentProjects",JSON.stringify(b))}else null===window.localStorage.getItem("recentProjects")&&(b={projects:[a]},window.localStorage.setItem("recentProjects",JSON.stringify(b)),console.log(window.localStorage.getItem("recentProjects")));this.m_saveProject(this)}else this.m_showError("Not a working project.","Missing Main.js and/or data folder.");
else{b=JSON.parse(window.localStorage.getItem("recentProjects"));for(c=0;c<this.elemManager.links.length;c++)this.elemManager.links[c].querySelector("p").innerHTML===a&&(this.elemManager.links[c].parentNode.removeChild(this.elemManager.links[c]),this.elemManager.links.splice(c,1));for(c=0;c<b.projects.length;c++)a===b.projects[c]&&b.projects.splice(c,1);window.localStorage.setItem("recentProjects",JSON.stringify(b))}};
d.project.ProjectManager.prototype.m_checkIfFolder=function(a){try{d.project.ProjectManager.fs.readdirSync(a)}catch(b){if("ENOENT"===b.code)return this.m_showError("Missing project folder","The project folder has either been removed, or moved to a new location."),!1}};
d.project.ProjectManager.prototype.m_walkDir=function(a){var b=this;d.project.ProjectManager.fs.readdirSync(a).forEach(function(c){c=d.project.ProjectManager.path.join(a,c);d.project.ProjectManager.fs.lstatSync(c).isDirectory()?(b.m_walkDir(c),b.paths.push(c)):c.match(/(^|\/)\.[^\/\.]/g)||b.paths.push(c)})};d.project.ProjectManager.prototype.m_checkProjectValidity=function(a){if(-1<this.paths.indexOf(a+"/src/system/Main.js")){if(-1<this.paths.indexOf(a+"/src/data"))return!0}else return!1};
d.project.ProjectManager.prototype.m_showError=function(a,b){this.modal=new d.project.Modal(this.modal,{type:"error",title:[a],message:[b]})};d.compiler.CompilerView=function(){d.ui.View.call(this,"Compiler");this.compileBtn=this.footer=this.tableElem=this.fileList=this.refreshBtn=this.outputPath=this.inputPath=this.inputBtn=this.form=null};d.compiler.CompilerView.prototype=Object.create(d.ui.View.prototype);d.compiler.CompilerView.prototype.constructor=d.compiler.CompilerView;Object.defineProperty(d.compiler.CompilerView.prototype,"setWarnings",{set:function(a){this.m_warningsElem.innerHTML=a.toString()}});
Object.defineProperty(d.compiler.CompilerView.prototype,"setErrors",{set:function(a){this.m_errorsElem.innerHTML=a.toString()}});d.compiler.CompilerView.prototype.init=function(){this.initHeader();this.m_renderForm();this.m_renderFileList();this.m_renderFooter()};
d.compiler.CompilerView.prototype.m_renderForm=function(){this.form=e.appendNewElem(this.toolHeader,"form");this.form.method="post";this.form.enctype="multipart/form-data";for(var a=[],b=[],c=[],g=[],f=0;2>f;f++)b.push(e.appendNewClassElem(this.form,"div","input-field")),c.push(e.appendNewClassElem(b[f],"div","output-row")),a.push(e.appendNewElem(c[f],"label")),g.push(e.appendNewElem(c[f],"div")),g[f].setAttribute("class","filepath");this.inputBtn=e.prependNewClassElem(b[0],"input","browse");this.inputBtn.setAttribute("type",
"button");this.inputBtn.setAttribute("value","Browse...");this.inputBtn.id="selectInputBtn";a[0].setAttribute("for","selectInputBtn");a[0].innerText="Select input folder";a[1].innerText="Output path";this.refreshBtn=e.appendNewClassElem(b[0],"input","refresh");this.refreshBtn.setAttribute("type","button");this.inputPath=g[0];this.outputPath=g[1];this.inputPath.innerHTML="No folder chosen.";this.outputPath.innerHTML=void 0===window.sessionStorage.output||""===window.sessionStorage.output?"No folder chosen.":
window.sessionStorage.output};
d.compiler.CompilerView.prototype.m_renderFileList=function(){this.fileList=e.appendNewClassElem(this.element,"div","fileIndex");var a=e.appendNewElem(this.fileList,"h3");e.setText(a,"Files");this.tableElem=e.appendNewElem(this.fileList,"table");a=e.appendNewElem(this.tableElem,"thead");a=e.appendNewElem(a,"tr");for(var b=[],c=0;5>c;c++)b.push(e.appendNewElem(a,"th"));e.setText(b[0],"Incl.");e.setText(b[1],"File path");e.setText(b[2],"Name");e.setText(b[3],"File size");e.setText(b[4],"")};
d.compiler.CompilerView.prototype.m_renderFooter=function(){this.footer=e.appendNewClassElem(this.element,"div","footer");var a=e.appendNewClassElem(this.footer,"div","problems-container"),b=e.appendNewClassElem(a,"div","problems-error");this.m_errorsElem=b.appendChild(e.p("0"));b.appendChild(e.p(" error(s) "));a=e.appendNewClassElem(a,"div","problems-warning");this.m_warningsElem=a.appendChild(e.p("0"));a.appendChild(e.p(" warning(s)"));this.compileBtn=e.appendNewElem(this.footer,"input");this.compileBtn.setAttribute("type",
"submit");this.compileBtn.setAttribute("value","Compile");this.compileBtn.setAttribute("id","compileBtn")};d.compiler.File=function(a,b){this.blob=a;this.path=b;this.status=[];this.name=null;this.size="";this.init()};d.compiler.File.ALLOWED_FILE_TYPES="image/png image/jpeg image/gif audio/ogg audio/mpeg application/xml application/json".split(" ");Object.defineProperty(d.compiler.File.prototype,"setStatus",{set:function(a){this.status.push(a)}});Object.defineProperty(d.compiler.File.prototype,"setName",{set:function(a){this.name=a}});
d.compiler.File.prototype.init=function(){this.name=this.m_getFileName(this.path);this.size=this.m_bytesToSize(this.blob.size)};d.compiler.File.prototype.removeError=function(a){for(var b=0;b<this.status.length;b++)this.status[b]===a&&this.status.splice(b,1)};d.compiler.File.prototype.isDuplicate=function(){for(var a=!1,b=0;b<this.status.length;b++)a=2===this.status[b]?!0:!1;return a};d.compiler.File.prototype.hasWarning=function(){for(;0<this.status.length;)return 10<=this.status[0]?!0:!1};
d.compiler.File.prototype.m_checkStatus=function(){0>d.compiler.File.ALLOWED_FILE_TYPES.indexOf(this.blob.type)&&(this.setStatus=1);("image/png"===this.blob.type||"image/jpg"===this.blob.type||"image/gif"===this.blob.type)&&11E5<this.blob.size&&(this.setStatus=10);("audio/ogg"===this.blob.type||"audio/mpeg"===this.blob.type)&&33E5<this.blob.size&&(this.setStatus=11)};
d.compiler.File.prototype.m_getFileName=function(a){a=a.replace(/^.*[\\\/]/,"");a=a.split(".").slice(0,-1).join(".");-1<a.indexOf(" ")&&(a=a.replace(" ","_"),this.setStatus=12);return a};d.compiler.File.prototype.m_bytesToSize=function(a){if(0===a)return"0 Byte";var b=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,b),2)+" "+["B","kB","MB","GB","TB"][b]};d.compiler.Message=function(){this.tbody=null;this.messages=[]};d.compiler.Message.prototype.create=function(a,b){this.tbody=e.createClassElem("tbody","message");a.insertBefore(this.tbody,a.children[b+1])};d.compiler.Message.prototype.addMessage=function(a){if(0<a.length)for(var b=0;b<a.length;b++){var c=new d.compiler.MessageRow(this.tbody,a[b]);c.setStatus=a[b];this.messages.push(c)}else c=new d.compiler.MessageRow(this.tbody,a),c.setStatus=a,this.messages.push(c);this.tbody.style.display="none"};
d.compiler.Message.prototype.addMessageAt=function(a){for(var b=0;b<a.length;b++){var c=new d.compiler.MessageRow(this.tbody,a[b]);c.setStatus=a[b];this.messages.push(c)}this.tbody.style.display="none"};d.compiler.Message.prototype.removeDup=function(){for(var a=0;a<this.messages.length;a++)2===this.messages[a].status&&(this.tbody.removeChild(this.messages[a].element),this.messages.splice(a,1))};
d.compiler.Message.prototype.containsDuplicateErr=function(){for(var a=!1,b=0;b<this.messages.length;b++)a=2===this.messages[b].status?!0:!1;return a};d.compiler.MessageRow=function(a,b){this.element=e.appendNewClassElem(a,"tr","msg");this.create(b);this.status=0};Object.defineProperty(d.compiler.MessageRow.prototype,"setStatus",{set:function(a){this.status=a}});d.compiler.MessageRow.prototype.create=function(a){this.setStyle(a);var b=e.appendNewElem(this.element,"td");b.setAttribute("colspan","5");b.innerHTML=this.codeToMessage(a)};d.compiler.MessageRow.prototype.m_toggleDisabled=function(a){this.element.style.display=a?"none":"table-row"};
d.compiler.MessageRow.prototype.codeToMessage=function(a){var b="";switch(a){case 1:b="Invalid file type.";break;case 2:b="Duplicate file name.";break;case 10:b="File size exceeds 1MB.";break;case 11:b="File size exceeds 3MB";break;case 12:b="Spaces not allowed in name. The name has been modified from the original filename."}return b};
d.compiler.MessageRow.prototype.setStyle=function(a){switch(a){case 0:this.element.classList.remove("error");break;case 1:this.element.classList.add("error");break;case 2:this.element.classList.add("error");break;case 10:this.element.classList.add("warning");break;case 11:this.element.classList.add("warning");break;case 12:this.element.classList.add("warning")}};d.compiler.TableRow=function(a){this.tbody=e.appendNewElem(a,"tbody");this.element=e.appendNewElem(this.tbody,"tr");this.include=!0;this.m_parentTable=a;this.tds=[];this.messageRow=this.textInput=null};d.compiler.TableRow.prototype.create=function(a){this.m_createCells(a);this.m_makeCollapsible();0<a.status.length&&this.m_changeStatus(a.status)};d.compiler.TableRow.prototype.m_createRow=function(){};
d.compiler.TableRow.prototype.m_createCells=function(a){for(var b=0;5>b;b++)this.tds.push(e.appendNewElem(this.element,"td"));this.m_addCheckbox(this.tds[0]);this.tds[1].innerHTML=a.path;this.m_inputName(this.tds[2],a.name);this.tds[3].innerHTML=a.size;this.tds[4].classList.add("coll-cell")};
d.compiler.TableRow.prototype.m_addCheckbox=function(a){var b=this;a=e.appendNewClassElem(a,"label","check-container");var c=e.appendNewClassElem(a,"input","checkbox");c.setAttribute("type","checkbox");c.setAttribute("checked","checked");c.addEventListener("click",function(){b.m_toggleInclude(this)});e.appendNewClassElem(a,"span","checkmark")};d.compiler.TableRow.prototype.m_toggleInclude=function(){this.element.classList.toggle("ignored");this.include=!0!==this.include};
d.compiler.TableRow.prototype.m_inputName=function(a,b){this.textInput=e.appendNewElem(a,"input");this.textInput.setAttribute("type","text");this.textInput.setAttribute("value",b);this.textInput.setAttribute("required","");this.textInput.addEventListener("keypress",function(a){32===a.keyCode&&a.preventDefault()})};d.compiler.TableRow.prototype.m_changeStatus=function(a){var b=0;if(0<a.length)for(var c=0;c<a.length;c++){if(1===a[c]||2===a[c])b=1;10<=a[c]&&(b=10)}this.m_styleRow(b)};
d.compiler.TableRow.prototype.m_styleRow=function(a){switch(a){case 0:this.element.classList.remove("error");break;case 1:this.element.classList.add("error");break;case 2:this.element.classList.add("error");break;case 10:this.element.classList.add("warning");break;case 11:this.element.classList.add("warning");break;case 12:this.element.classList.add("warning");break;case 5:this.element.classList.remove("warning"),this.element.classList.add("error")}};
d.compiler.TableRow.prototype.m_toggleDisabled=function(a){a&&(this.messageRow.style.display="none");this.m_makeCollapsible()};d.compiler.TableRow.prototype.m_makeCollapsible=function(){var a=this;this.tds[4].addEventListener("click",function(){a.m_collapse(this)})};
d.compiler.TableRow.prototype.m_collapse=function(a){if(this.element.classList.contains("error")||this.element.classList.contains("warning"))a.classList.toggle("coll-active"),a=this.tbody.nextElementSibling,"table-row-group"===a.style.display?a.style.display="none":"none"===a.style.display&&(a.style.display="table-row-group")};d.compiler.Compiler=function(){this.m_view=null;this.m_files=[];this.m_warnings=this.m_errors=0;this.modal=null};d.compiler.Compiler.dialog=require("electron").remote.dialog;d.compiler.Compiler.fs=require("fs");d.compiler.Compiler.path=require("path");d.compiler.Compiler.prototype.init=function(){this.m_initUI()};d.compiler.Compiler.prototype.m_initUI=function(){this.m_view=new d.compiler.CompilerView;this.m_view.init();this.m_addListeners()};
d.compiler.Compiler.prototype.m_addListeners=function(){var a=this;this.m_view.inputBtn.addEventListener("click",function(){a.m_uploadFiles(this)});this.m_view.compileBtn.addEventListener("click",function(){a.m_compile(this)})};
d.compiler.Compiler.prototype.m_compile=function(){for(var a=[],b=0;b<this.m_files.length;b++)!0===this.m_files[b].row.include&&a.push(this.m_files[b].file);for(b=0;b<a.length;b++)if(0<a[b].status.length)for(var c=0;c<a[b].status.length;c++){if(1===a[b].status[c]||2===a[b].status[c]){this.modal=new d.project.Modal(this.modal,{type:"error",title:"Can't compile",message:"Your selected folder contains errors."});return}}else if(""===a[b].name){this.modal=new d.project.Modal(this.modal,{type:"error",
title:"Can't compile",message:"One or more resources is not named."});return}(new d.Resourcefile(window.sessionStorage.name,window.sessionStorage.projectLocation)).compile(a)};
d.compiler.Compiler.prototype.m_uploadFiles=function(){var a=this;d.compiler.Compiler.dialog.showOpenDialog({title:"Select a folder",properties:["openDirectory"]},function(b){void 0===b||0===b.length?console.log("No destination folder selected"):(a.m_emptyTable(),a.m_view.inputPath.innerHTML=b[0],a.m_walkDir(b[0]))});this.m_view.refreshBtn.addEventListener("click",function(){a.m_refresh(this)})};
d.compiler.Compiler.prototype.m_refresh=function(){""!==this.m_view.inputPath.innerHTML&&(this.m_emptyTable(),this.m_walkDir(this.m_view.inputPath.innerHTML))};d.compiler.Compiler.prototype.m_emptyTable=function(){this.m_warnings=0;this.m_view.setWarnings=this.m_warnings;this.m_errors=0;for(this.m_view.setErrors=this.m_errors;1<this.m_view.tableElem.childNodes.length;)this.m_view.tableElem.removeChild(this.m_view.tableElem.lastChild);this.m_files=[]};
d.compiler.Compiler.prototype.m_walkDir=function(a){var b=this;d.compiler.Compiler.fs.readdirSync(a).forEach(function(c){c=d.compiler.Compiler.path.join(a,c);d.compiler.Compiler.fs.lstatSync(c).isDirectory()?b.m_walkDir(c):c.match(/(^|\/)\.[^\/\.]/g)||b.m_requestFile(c)})};
d.compiler.Compiler.prototype.m_requestFile=function(a){var b=this,c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onreadystatechange=function(){4===c.readyState&&(200===c.status?b.m_getData(new d.compiler.File(this.response,a)):console.log("Error..."))};c.send()};
d.compiler.Compiler.prototype.m_getData=function(a){var b=this;a.m_checkStatus();0<this.m_files.length&&b.m_checkIfDuplicate(a.name)&&(a.setStatus=2,this.m_checkForNewDuplicates(a.name));var c=new d.compiler.TableRow(this.m_view.tableElem);c.create(a);c.textInput.addEventListener("input",function(a){b.m_changeName(a,c)});if(0<a.status.length){var g=new d.compiler.Message(this.m_view.tableElem);g.create(this.m_view.tableElem,this.m_view.tableElem.childNodes);g.addMessage(a.status);for(var f=0;f<a.status.length;f++)this.m_incrementException(a.status[f])}this.m_files.push({file:a,
row:c,message:g})};d.compiler.Compiler.prototype.m_incrementException=function(a){0<a&&10>a&&(this.m_errors++,this.m_view.setErrors=this.m_errors);10<=a&&(this.m_warnings++,this.m_view.setWarnings=this.m_warnings)};d.compiler.Compiler.prototype.m_decrementException=function(a){0<a&&10>a&&(this.m_errors--,this.m_view.setErrors=this.m_errors);10<=a&&(this.m_warnings--,this.m_view.setWarnings=this.m_warnings)};
d.compiler.Compiler.prototype.m_checkIfDuplicate=function(a){for(var b=!1,c=0;c<this.m_files.length;c++)this.m_files[c].file.name===a&&(b=!0);return b};
d.compiler.Compiler.prototype.m_changeName=function(a,b){for(a=0;a<this.m_files.length;a++)if(this.m_files[a].row===b){var c=this.m_files[a];this.m_checkIfDuplicate(b.textInput.value)&&c.file.isDuplicate()?(this.m_checkRemainingDuplicates(c.file.name),this.m_checkForNewDuplicates(b.textInput.value)):this.m_checkIfDuplicate(b.textInput.value)&&!c.file.isDuplicate()?(this.m_checkForNewDuplicates(b.textInput.value),this.m_addDuplicateError(c,a+2)):!this.m_checkIfDuplicate(b.textInput.value)&&c.file.isDuplicate()&&
(this.m_removeDuplicateError(c),this.m_checkRemainingDuplicates(c.file.name));this.m_files[a].file.setName=b.textInput.value}};d.compiler.Compiler.prototype.m_checkRemainingDuplicates=function(a){for(var b=0,c=0;c<this.m_files.length;c++)this.m_files[c].row.textInput.value===a&&b++;for(c=0;c<this.m_files.length;c++)this.m_files[c].row.textInput.value===a&&1>=b&&this.m_removeDuplicateError(this.m_files[c])};
d.compiler.Compiler.prototype.m_checkForNewDuplicates=function(a){for(var b=0;b<this.m_files.length;b++)if(this.m_files[b].file.name===a&&!this.m_files[b].file.isDuplicate()){for(var c=0,g=0;g<this.m_view.tableElem.childNodes.length;g++)this.m_view.tableElem.childNodes[g].childNodes[0]===this.m_files[b].row.element&&(c=g);this.m_addDuplicateError(this.m_files[b],c)}};
d.compiler.Compiler.prototype.m_addDuplicateError=function(a,b){a.file.setStatus=2;if(void 0===a.message||null===a.message){var c=new d.compiler.Message(this.m_view.tableElem);c.create(this.m_view.tableElem,b);a.message=c}a.message.addMessage(2);a.file.hasWarning()?a.row.m_styleRow(5):a.row.m_styleRow(2);this.m_incrementException(2)};
d.compiler.Compiler.prototype.m_removeDuplicateError=function(a){a.message.containsDuplicateErr()&&(a.message.removeDup(),a.file.removeError(2));-1<a.file.status.indexOf(10)&&a.row.m_styleRow(10);this.m_decrementException(2);0===a.file.status.length&&(a.message.tbody.parentNode.removeChild(a.message.tbody),a.message=null,a.row.tds[4].classList.contains("coll-active")&&a.row.tds[4].classList.remove("coll-active"),a.row.m_styleRow(0))};d.system.Main=function(){this.project=this.projectManager=null};d.system.Main.init=function(){d.system.Main.m_initUI()};d.system.Main.m_initUI=function(){this.projectManager=new d.project.ProjectManager(d.system.Main.m_addProject);this.projectManager.init()};d.system.Main.m_addProject=function(a){this.project=a;this.project.init()};d.system.Main.m_removeProject=function(){this.project=null};window.addEventListener("load",d.system.Main.init);"undefined"!==typeof window&&"undefined"===typeof window.birka&&(window.birka=d);}).call(this);
